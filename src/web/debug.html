<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forzar Recarga Cache - Debug Explicaciones</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Debug Explicaciones - Forzar Recarga Cache</h1>
    
    <div class="debug-section info">
        <h3>üìã Instrucciones:</h3>
        <ol>
            <li>Haz clic en "Verificar Explicaciones" para ver el estado actual</li>
            <li>Haz clic en "Forzar Recarga Completa" para limpiar cache</li>
            <li>Recarga la p√°gina principal y verifica los botones</li>
        </ol>
    </div>
    
    <div class="debug-section">
        <h3>üîç Verificar Estado Actual</h3>
        <button onclick="verificarExplicaciones()">Verificar Explicaciones</button>
        <div id="resultado-verificacion"></div>
    </div>
    
    <div class="debug-section">
        <h3>üîÑ Forzar Recarga Completa</h3>
        <button onclick="forzarRecargaCompleta()">Forzar Recarga Completa</button>
        <div id="resultado-recarga"></div>
    </div>
    
    <div class="debug-section">
        <h3>üìä Logs de Debug</h3>
        <button onclick="limpiarLogs()">Limpiar Logs</button>
        <pre id="logs"></pre>
    </div>

    <script>
        function log(mensaje) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${mensaje}\n`;
        }
        
        function limpiarLogs() {
            document.getElementById('logs').textContent = '';
        }
        
        async function verificarExplicaciones() {
            log('üîç Verificando explicaciones...');
            
            try {
                // Cargar datos principales
                const dataResponse = await fetch('data/json/data_unificado_con_duplicados.json');
                const data = await dataResponse.json();
                log(`‚úÖ Datos cargados: ${data.examenes.length} ex√°menes`);
                
                // Cargar explicaciones
                const explicacionesResponse = await fetch('data/json/explicaciones.json');
                const explicaciones = await explicacionesResponse.json();
                log(`‚úÖ Explicaciones cargadas: ${Object.keys(explicaciones).length}`);
                log(`üîë Hashes: ${Object.keys(explicaciones).join(', ')}`);
                
                // Verificar preguntas con explicaci√≥n
                let preguntasConExplicacion = 0;
                let explicacionesEncontradas = 0;
                
                for (const examen of data.examenes) {
                    for (const pregunta of examen.preguntas) {
                        if (pregunta.hash_explicacion) {
                            preguntasConExplicacion++;
                            if (explicaciones[pregunta.hash_explicacion]) {
                                explicacionesEncontradas++;
                            }
                        }
                    }
                }
                
                const resultado = `
                    <div class="success">
                        <h4>‚úÖ Verificaci√≥n Completada</h4>
                        <p><strong>Preguntas con hash_explicacion:</strong> ${preguntasConExplicacion}</p>
                        <p><strong>Explicaciones encontradas:</strong> ${explicacionesEncontradas}</p>
                        <p><strong>Coincidencias:</strong> ${explicacionesEncontradas}/${preguntasConExplicacion}</p>
                        <p><strong>Porcentaje:</strong> ${Math.round((explicacionesEncontradas / preguntasConExplicacion) * 100)}%</p>
                    </div>
                `;
                
                document.getElementById('resultado-verificacion').innerHTML = resultado;
                log(`üìä Resultado: ${explicacionesEncontradas}/${preguntasConExplicacion} (${Math.round((explicacionesEncontradas / preguntasConExplicacion) * 100)}%)`);
                
            } catch (error) {
                const resultado = `
                    <div class="error">
                        <h4>‚ùå Error en Verificaci√≥n</h4>
                        <p>${error.message}</p>
                    </div>
                `;
                document.getElementById('resultado-verificacion').innerHTML = resultado;
                log(`‚ùå Error: ${error.message}`);
            }
        }
        
        function forzarRecargaCompleta() {
            log('üîÑ Forzando recarga completa del cache...');
            
            // Limpiar localStorage
            localStorage.clear();
            log('‚úÖ localStorage limpiado');
            
            // Limpiar sessionStorage
            sessionStorage.clear();
            log('‚úÖ sessionStorage limpiado');
            
            // Forzar recarga con par√°metros de cache busting
            const timestamp = Date.now();
            const url = `index.html?t=${timestamp}&cache=bust`;
            
            const resultado = `
                <div class="success">
                    <h4>‚úÖ Cache Limpiado</h4>
                    <p>localStorage y sessionStorage limpiados</p>
                    <p><a href="${url}" target="_blank">Abrir p√°gina principal con cache busting</a></p>
                    <p><strong>O simplemente:</strong> Ctrl+F5 (Windows) o Cmd+Shift+R (Mac)</p>
                </div>
            `;
            
            document.getElementById('resultado-recarga').innerHTML = resultado;
            log('‚úÖ Cache limpiado. Usa Ctrl+F5 o Cmd+Shift+R para recargar');
        }
        
        // Auto-verificar al cargar
        window.addEventListener('load', () => {
            log('üöÄ P√°gina de debug cargada');
            verificarExplicaciones();
        });
    </script>
</body>
</html>
